{"version":3,"sources":["../src/api/client.ts","../src/utils.ts","../src/intent.ts","../src/state.ts"],"sourcesContent":["/**\n * Reevit API Client\n * \n * Handles communication with the Reevit backend for payment operations.\n */\n\nimport type { PaymentMethod, ReevitCheckoutConfig, PaymentError, HubtelSessionResponse } from '../types';\n\n// API Response Types (matching backend handlers_payments.go)\nexport interface CreatePaymentIntentRequest {\n  amount: number;\n  currency: string;\n  method?: string;\n  country: string;\n  customer_id?: string;\n  metadata?: Record<string, unknown>;\n  description?: string;\n  policy?: {\n    prefer?: string[];\n    allowed_providers?: string[];\n    max_amount?: number;\n    blocked_bins?: string[];\n    allowed_bins?: string[];\n    velocity_max_per_minute?: number;\n  };\n}\n\nexport interface PaymentIntentResponse {\n  id: string;\n  org_id?: string;\n  connection_id: string;\n  provider: string;\n  status: string;\n  client_secret: string;\n  psp_public_key: string;\n  psp_credentials?: {\n    merchantAccount?: string | number;\n    basicAuth?: string;\n    [key: string]: unknown;\n  };\n  amount: number;\n  currency: string;\n  fee_amount: number;\n  fee_currency: string;\n  net_amount: number;\n  reference?: string;\n  available_psps?: Array<{\n    provider: string;\n    name: string;\n    methods: string[];\n    countries?: string[];\n  }>;\n  branding?: Record<string, unknown>;\n}\n\nexport interface ConfirmPaymentRequest {\n  provider_ref_id: string;\n  provider_data?: Record<string, unknown>;\n}\n\nexport interface PaymentDetailResponse {\n  id: string;\n  connection_id: string;\n  provider: string;\n  method: string;\n  status: string;\n  amount: number;\n  currency: string;\n  fee_amount: number;\n  fee_currency: string;\n  net_amount: number;\n  customer_id?: string;\n  client_secret: string;\n  provider_ref_id?: string;\n  metadata?: Record<string, unknown>;\n  created_at: string;\n  updated_at: string;\n  /** Payment source type (payment_link, api, subscription) */\n  source?: 'payment_link' | 'api' | 'subscription';\n  /** ID of the source (payment link ID, subscription ID, etc.) */\n  source_id?: string;\n  /** Human-readable description of the source (e.g., payment link name) */\n  source_description?: string;\n}\n\nexport interface APIErrorResponse {\n  code: string;\n  message: string;\n  details?: Record<string, string>;\n}\n\n// API Client configuration\nexport interface ReevitAPIClientConfig {\n  /** Your Reevit public key */\n  publicKey?: string;\n  /** Base URL for the Reevit API (defaults to production) */\n  baseUrl?: string;\n  /** Request timeout in milliseconds */\n  timeout?: number;\n}\n\n// Default API base URLs\nconst API_BASE_URL_PRODUCTION = 'https://api.reevit.io';\nconst API_BASE_URL_SANDBOX = 'https://sandbox-api.reevit.io';\nconst DEFAULT_TIMEOUT = 30000; // 30 seconds\n\n/**\n * Determines if a public key is for sandbox mode\n */\nexport function isSandboxKey(publicKey: string): boolean {\n  return publicKey.startsWith('pk_test_') ||\n    publicKey.startsWith('pk_sandbox_') ||\n    publicKey.startsWith('pfk_test_') ||\n    publicKey.startsWith('pfk_sandbox_');\n}\n\n/**\n * Creates a PaymentError from an API error response\n */\nfunction createPaymentError(response: Response, errorData: APIErrorResponse): PaymentError {\n  return {\n    code: errorData.code || 'api_error',\n    message: errorData.message || 'An unexpected error occurred',\n    details: {\n      httpStatus: response.status,\n      ...errorData.details,\n    },\n  };\n}\n\n/**\n * Generates a deterministic idempotency key based on input parameters\n * Uses a simple hash function suitable for browser environments\n * Exported for use by SDK hooks (e.g., payment link flows)\n */\nexport function generateIdempotencyKey(params: Record<string, unknown>): string {\n  // Create a stable string representation of the parameters\n  const sortedKeys = Object.keys(params).sort();\n  const stableString = sortedKeys\n    .map(key => `${key}:${JSON.stringify(params[key])}`)\n    .join('|');\n\n  // Simple hash function (djb2 algorithm)\n  let hash = 5381;\n  for (let i = 0; i < stableString.length; i++) {\n    hash = ((hash << 5) + hash) + stableString.charCodeAt(i);\n    hash = hash & hash; // Convert to 32-bit integer\n  }\n\n  // Convert to positive hex string\n  const hashHex = (hash >>> 0).toString(16);\n\n  // Add a time bucket (5-minute windows) to allow retries within a reasonable window\n  // but prevent keys from being reused across completely different sessions\n  const timeBucket = Math.floor(Date.now() / (5 * 60 * 1000));\n\n  return `reevit_${timeBucket}_${hashHex}`;\n}\n\n/**\n * Reevit API Client\n */\nexport class ReevitAPIClient {\n  private readonly publicKey: string;\n  private readonly baseUrl: string;\n  private readonly timeout: number;\n\n  constructor(config: ReevitAPIClientConfig) {\n    this.publicKey = config.publicKey || '';\n    this.baseUrl = config.baseUrl || (config.publicKey && isSandboxKey(config.publicKey)\n      ? API_BASE_URL_SANDBOX\n      : API_BASE_URL_PRODUCTION);\n    this.timeout = config.timeout || DEFAULT_TIMEOUT;\n  }\n\n  /**\n   * Makes an authenticated API request\n   * @param idempotencyKey Optional deterministic idempotency key for the request\n   */\n  private async request<T>(\n    method: string,\n    path: string,\n    body?: unknown,\n    idempotencyKey?: string\n  ): Promise<{ data?: T; error?: PaymentError }> {\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n    // Generate headers with idempotency key for mutating requests\n    const headers: Record<string, string> = {\n      'Content-Type': 'application/json',\n      'X-Reevit-Client': '@reevit/core',\n      'X-Reevit-Client-Version': '0.5.9',\n    };\n    if (this.publicKey) {\n      headers['X-Reevit-Key'] = this.publicKey;\n    }\n\n    if (method === 'POST' || method === 'PATCH' || method === 'PUT') {\n      // Use provided deterministic key, or generate one based on request body\n      headers['Idempotency-Key'] = idempotencyKey ||\n        (body ? generateIdempotencyKey(body as Record<string, unknown>) : `${Date.now()}-${Math.random().toString(36).substring(2, 15)}`);\n    }\n\n    try {\n      const response = await fetch(`${this.baseUrl}${path}`, {\n        method,\n        headers,\n        body: body ? JSON.stringify(body) : undefined,\n        signal: controller.signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      const responseData = await response.json().catch(() => ({}));\n\n      if (!response.ok) {\n        return {\n          error: createPaymentError(response, responseData as APIErrorResponse),\n        };\n      }\n\n      return { data: responseData as T };\n    } catch (err) {\n      clearTimeout(timeoutId);\n\n      if (err instanceof Error) {\n        if (err.name === 'AbortError') {\n          return {\n            error: {\n              code: 'request_timeout',\n              message: 'The request timed out. Please try again.',\n            },\n          };\n        }\n\n        if (err.message.includes('Failed to fetch') || err.message.includes('NetworkError')) {\n          return {\n            error: {\n              code: 'network_error',\n              message: 'Unable to connect to Reevit. Please check your internet connection.',\n            },\n          };\n        }\n      }\n\n      return {\n        error: {\n          code: 'unknown_error',\n          message: 'An unexpected error occurred. Please try again.',\n        },\n      };\n    }\n  }\n\n  /**\n   * Creates a payment intent\n   */\n  async createPaymentIntent(\n    config: ReevitCheckoutConfig,\n    method?: PaymentMethod,\n    country: string = 'GH',\n    options?: { preferredProviders?: string[]; allowedProviders?: string[] }\n  ): Promise<{ data?: PaymentIntentResponse; error?: PaymentError }> {\n    // Build metadata with customer_email for PSP providers that require it\n    const metadata: Record<string, unknown> = { ...config.metadata };\n    if (config.email) {\n      metadata.customer_email = config.email;\n    }\n    if (config.phone) {\n      metadata.customer_phone = config.phone;\n    }\n\n    const request: CreatePaymentIntentRequest = {\n      amount: config.amount,\n      currency: config.currency,\n      country,\n      customer_id: config.email || (config.metadata?.customerId as string | undefined),\n      metadata,\n    };\n\n    if (method) {\n      request.method = this.mapPaymentMethod(method);\n    }\n\n    if (options?.preferredProviders?.length || options?.allowedProviders?.length) {\n      request.policy = {\n        prefer: options?.preferredProviders,\n        allowed_providers: options?.allowedProviders,\n      };\n    }\n\n    // Generate a deterministic idempotency key based on payment parameters\n    // This ensures that duplicate requests for the same payment return the same intent\n    const idempotencyKey = config.idempotencyKey || generateIdempotencyKey({\n      amount: config.amount,\n      currency: config.currency,\n      customer: config.email || config.metadata?.customerId || '',\n      reference: config.reference || '',\n      method: method || '',\n      provider: options?.preferredProviders?.[0] || options?.allowedProviders?.[0] || '',\n      publicKey: this.publicKey,\n    });\n\n    return this.request<PaymentIntentResponse>('POST', '/v1/payments/intents', request, idempotencyKey);\n  }\n\n  /**\n   * Retrieves a payment intent by ID\n   */\n  async getPaymentIntent(paymentId: string): Promise<{ data?: PaymentDetailResponse; error?: PaymentError }> {\n    return this.request<PaymentDetailResponse>('GET', `/v1/payments/${paymentId}`);\n  }\n\n  /**\n   * Confirms a payment after PSP callback\n   */\n  async confirmPayment(paymentId: string): Promise<{ data?: PaymentDetailResponse; error?: PaymentError }> {\n    return this.request<PaymentDetailResponse>('POST', `/v1/payments/${paymentId}/confirm`);\n  }\n\n  /**\n   * Confirms a payment intent using client secret (public endpoint)\n   */\n  async confirmPaymentIntent(paymentId: string, clientSecret: string): Promise<{ data?: PaymentDetailResponse; error?: PaymentError }> {\n    return this.request<PaymentDetailResponse>('POST', `/v1/payments/${paymentId}/confirm-intent?client_secret=${clientSecret}`);\n  }\n\n  /**\n   * Cancels a payment intent\n   */\n  async cancelPaymentIntent(paymentId: string): Promise<{ data?: PaymentDetailResponse; error?: PaymentError }> {\n    return this.request<PaymentDetailResponse>('POST', `/v1/payments/${paymentId}/cancel`);\n  }\n\n  /**\n   * Creates a Hubtel session token for secure checkout\n   * Returns a short-lived token that contains Hubtel credentials\n   * Credentials are never exposed to the client directly\n   */\n  async createHubtelSession(\n    paymentId: string,\n    clientSecret?: string\n  ): Promise<{ data?: HubtelSessionResponse; error?: PaymentError }> {\n    const query = clientSecret ? `?client_secret=${encodeURIComponent(clientSecret)}` : '';\n    return this.request<HubtelSessionResponse>('POST', `/v1/payments/hubtel/sessions/${paymentId}${query}`);\n  }\n\n  /**\n   * Maps SDK payment method to backend format\n   */\n  private mapPaymentMethod(method: PaymentMethod): string {\n    switch (method) {\n      case 'card':\n        return 'card';\n      case 'mobile_money':\n        return 'mobile_money';\n      case 'bank_transfer':\n        return 'bank_transfer';\n      default:\n        return method;\n    }\n  }\n}\n\n/**\n * Creates a new Reevit API client instance\n */\nexport function createReevitClient(config: ReevitAPIClientConfig): ReevitAPIClient {\n  return new ReevitAPIClient(config);\n}\n","/**\n * Utility Functions\n * Shared utilities for Reevit SDKs\n */\n\nimport type { MobileMoneyNetwork, ReevitTheme } from './types';\n\n/**\n * Formats an amount from smallest currency unit to display format\n */\nexport function formatAmount(amount: number, currency: string): string {\n  const majorUnit = amount / 100;\n\n  const currencyFormats: Record<string, { locale: string; minimumFractionDigits: number }> = {\n    GHS: { locale: 'en-GH', minimumFractionDigits: 2 },\n    NGN: { locale: 'en-NG', minimumFractionDigits: 2 },\n    KES: { locale: 'en-KE', minimumFractionDigits: 2 },\n    USD: { locale: 'en-US', minimumFractionDigits: 2 },\n    EUR: { locale: 'de-DE', minimumFractionDigits: 2 },\n    GBP: { locale: 'en-GB', minimumFractionDigits: 2 },\n  };\n\n  const format = currencyFormats[currency.toUpperCase()] || { locale: 'en-US', minimumFractionDigits: 2 };\n\n  try {\n    return new Intl.NumberFormat(format.locale, {\n      style: 'currency',\n      currency: currency.toUpperCase(),\n      minimumFractionDigits: format.minimumFractionDigits,\n    }).format(majorUnit);\n  } catch {\n    // Fallback for unsupported currencies\n    return `${currency} ${majorUnit.toFixed(2)}`;\n  }\n}\n\n/**\n * Generates a unique payment reference\n */\nexport function generateReference(prefix: string = 'reevit'): string {\n  const timestamp = Date.now().toString(36);\n  const random = Math.random().toString(36).substring(2, 8);\n  return `${prefix}_${timestamp}_${random}`;\n}\n\n/**\n * Validates a phone number for mobile money\n */\nexport function validatePhone(phone: string, country: string = 'GH'): boolean {\n  // Remove non-digit characters\n  const digits = phone.replace(/\\D/g, '');\n\n  const patterns: Record<string, RegExp> = {\n    GH: /^(?:233|0)?[235][0-9]{8}$/, // Ghana\n    NG: /^(?:234|0)?[789][01][0-9]{8}$/, // Nigeria\n    KE: /^(?:254|0)?[17][0-9]{8}$/, // Kenya\n  };\n\n  const pattern = patterns[country.toUpperCase()];\n  if (!pattern) return digits.length >= 10;\n\n  return pattern.test(digits);\n}\n\n/**\n * Formats a phone number for display\n */\nexport function formatPhone(phone: string, country: string = 'GH'): string {\n  const digits = phone.replace(/\\D/g, '');\n\n  if (country === 'GH') {\n    // Format as 0XX XXX XXXX\n    if (digits.startsWith('233') && digits.length === 12) {\n      const local = '0' + digits.slice(3);\n      return `${local.slice(0, 3)} ${local.slice(3, 6)} ${local.slice(6)}`;\n    }\n    if (digits.length === 10 && digits.startsWith('0')) {\n      return `${digits.slice(0, 3)} ${digits.slice(3, 6)} ${digits.slice(6)}`;\n    }\n  }\n\n  return phone;\n}\n\n/**\n * Detects mobile money network from phone number (Ghana)\n */\nexport function detectNetwork(phone: string): MobileMoneyNetwork | null {\n  const digits = phone.replace(/\\D/g, '');\n\n  // Get the network prefix (first 3 digits after country code or 0)\n  let prefix: string;\n  if (digits.startsWith('233')) {\n    prefix = digits.slice(3, 5);\n  } else if (digits.startsWith('0')) {\n    prefix = digits.slice(1, 3);\n  } else {\n    prefix = digits.slice(0, 2);\n  }\n\n  // Ghana network prefixes\n  const mtnPrefixes = ['24', '25', '53', '54', '55', '59'];\n  const telecelPrefixes = ['20', '50'];\n  const airteltigoPrefixes = ['26', '27', '56', '57'];\n\n  if (mtnPrefixes.includes(prefix)) return 'mtn';\n  if (telecelPrefixes.includes(prefix)) return 'telecel';\n  if (airteltigoPrefixes.includes(prefix)) return 'airteltigo';\n\n  return null;\n}\n\n/**\n * Creates CSS custom property variables from theme\n */\nexport function createThemeVariables(theme: ReevitTheme): Record<string, string> {\n  const variables: Record<string, string> = {};\n\n  // Primary color = main text color\n  if (theme.primaryColor) {\n    variables['--reevit-text'] = theme.primaryColor;\n  }\n\n  // Primary foreground = description/secondary text color\n  if (theme.primaryForegroundColor) {\n    variables['--reevit-text-secondary'] = theme.primaryForegroundColor;\n    variables['--reevit-muted'] = theme.primaryForegroundColor;\n  }\n\n  // Button colors\n  if (theme.buttonBackgroundColor) {\n    variables['--reevit-primary'] = theme.buttonBackgroundColor;\n    variables['--reevit-primary-hover'] = theme.buttonBackgroundColor;\n  }\n  if (theme.buttonTextColor) {\n    variables['--reevit-primary-foreground'] = theme.buttonTextColor;\n  }\n\n  // Background and surface colors\n  if (theme.backgroundColor) {\n    variables['--reevit-background'] = theme.backgroundColor;\n    variables['--reevit-surface'] = theme.backgroundColor;\n  }\n  if (theme.surfaceColor) {\n    variables['--reevit-surface'] = theme.surfaceColor;\n  }\n\n  // Border color\n  if (theme.borderColor) {\n    variables['--reevit-border'] = theme.borderColor;\n  }\n\n  // Legacy text color support\n  if (theme.textColor) {\n    variables['--reevit-text'] = theme.textColor;\n  }\n  if (theme.mutedTextColor) {\n    variables['--reevit-text-secondary'] = theme.mutedTextColor;\n  }\n\n  // Border radius\n  if (theme.borderRadius) {\n    variables['--reevit-radius'] = theme.borderRadius;\n    variables['--reevit-radius-sm'] = theme.borderRadius;\n    variables['--reevit-radius-lg'] = theme.borderRadius;\n  }\n\n  // Font family\n  if (theme.fontFamily) {\n    variables['--reevit-font'] = theme.fontFamily;\n  }\n\n  return variables;\n}\n\nfunction getContrastingColor(color: string): string | null {\n  const hex = color.trim();\n  if (!hex.startsWith('#')) {\n    return null;\n  }\n\n  const normalized = hex.length === 4\n    ? `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`\n    : hex;\n\n  if (normalized.length !== 7) {\n    return null;\n  }\n\n  const r = parseInt(normalized.slice(1, 3), 16);\n  const g = parseInt(normalized.slice(3, 5), 16);\n  const b = parseInt(normalized.slice(5, 7), 16);\n\n  if (Number.isNaN(r) || Number.isNaN(g) || Number.isNaN(b)) {\n    return null;\n  }\n\n  const brightness = (r * 299 + g * 587 + b * 114) / 1000;\n  return brightness >= 140 ? '#0b1120' : '#ffffff';\n}\n\n/**\n * Simple class name concatenation utility\n */\nexport function cn(...classes: (string | boolean | undefined | null)[]): string {\n  return classes.filter(Boolean).join(' ');\n}\n\n/**\n * Detects country code from currency\n */\nexport function detectCountryFromCurrency(currency: string): string {\n  const currencyToCountry: Record<string, string> = {\n    GHS: 'GH',\n    NGN: 'NG',\n    KES: 'KE',\n    UGX: 'UG',\n    TZS: 'TZ',\n    ZAR: 'ZA',\n    XOF: 'CI',\n    XAF: 'CM',\n    USD: 'US',\n    EUR: 'DE',\n    GBP: 'GB',\n  };\n\n  return currencyToCountry[currency.toUpperCase()] || 'GH';\n}\n","/**\n * Intent identity + cache helpers\n */\n\nimport type { PaymentIntentResponse } from './api/client';\nimport { generateIdempotencyKey } from './api/client';\nimport type { PaymentMethod, ReevitCheckoutConfig } from './types';\nimport { generateReference } from './utils';\n\nconst INTENT_CACHE_TTL_MS = 10 * 60 * 1000; // 10 minutes\n\nexport interface IntentIdentityOptions {\n  config: ReevitCheckoutConfig;\n  method?: PaymentMethod;\n  preferredProvider?: string;\n  allowedProviders?: string[];\n  publicKey?: string;\n}\n\nexport interface IntentCacheEntry {\n  promise?: Promise<PaymentIntentResponse>;\n  response?: PaymentIntentResponse;\n  expiresAt: number;\n  reference?: string;\n}\n\nconst intentCache = new Map<string, IntentCacheEntry>();\n\nfunction pruneIntentCache(now: number = Date.now()): void {\n  for (const [key, entry] of intentCache) {\n    if (entry.expiresAt <= now) {\n      intentCache.delete(key);\n    }\n  }\n}\n\nfunction getIntentCacheEntryInternal(key: string): IntentCacheEntry | undefined {\n  const entry = intentCache.get(key);\n  if (!entry) {\n    return undefined;\n  }\n  if (entry.expiresAt <= Date.now()) {\n    intentCache.delete(key);\n    return undefined;\n  }\n  return entry;\n}\n\nfunction setIntentCacheEntryInternal(key: string, update: Partial<IntentCacheEntry>): IntentCacheEntry {\n  const now = Date.now();\n  const existing = getIntentCacheEntryInternal(key);\n  const next: IntentCacheEntry = {\n    ...existing,\n    ...update,\n    expiresAt: now + INTENT_CACHE_TTL_MS,\n  };\n  intentCache.set(key, next);\n  return next;\n}\n\nfunction buildIdempotencyPayload(options: IntentIdentityOptions): Record<string, unknown> {\n  const { config, method, preferredProvider, allowedProviders, publicKey } = options;\n  const payload: Record<string, unknown> = {\n    amount: config.amount,\n    currency: config.currency,\n    email: config.email || '',\n    phone: config.phone || '',\n    customerName: config.customerName || '',\n    paymentLinkCode: config.paymentLinkCode || '',\n    paymentMethods: config.paymentMethods || [],\n    metadata: config.metadata || {},\n    customFields: config.customFields || {},\n    method: method || '',\n    preferredProvider: preferredProvider || '',\n    allowedProviders: allowedProviders || [],\n    publicKey: publicKey || config.publicKey || '',\n  };\n\n  if (config.reference) {\n    payload.reference = config.reference;\n  }\n\n  return payload;\n}\n\nexport function resolveIntentIdentity(options: IntentIdentityOptions): {\n  idempotencyKey: string;\n  reference: string;\n  cacheEntry?: IntentCacheEntry;\n} {\n  pruneIntentCache();\n\n  const idempotencyKey =\n    options.config.idempotencyKey || generateIdempotencyKey(buildIdempotencyPayload(options));\n  const existing = getIntentCacheEntryInternal(idempotencyKey);\n  const reference = options.config.reference || existing?.reference || generateReference();\n\n  const cacheEntry = setIntentCacheEntryInternal(idempotencyKey, { reference });\n\n  return { idempotencyKey, reference, cacheEntry };\n}\n\nexport function getIntentCacheEntry(idempotencyKey: string): IntentCacheEntry | undefined {\n  pruneIntentCache();\n  return getIntentCacheEntryInternal(idempotencyKey);\n}\n\nexport function cacheIntentPromise(\n  idempotencyKey: string,\n  promise: Promise<PaymentIntentResponse>\n): IntentCacheEntry {\n  return setIntentCacheEntryInternal(idempotencyKey, { promise });\n}\n\nexport function cacheIntentResponse(\n  idempotencyKey: string,\n  response: PaymentIntentResponse\n): IntentCacheEntry {\n  return setIntentCacheEntryInternal(idempotencyKey, { response, promise: undefined });\n}\n\nexport function clearIntentCacheEntry(idempotencyKey: string): void {\n  intentCache.delete(idempotencyKey);\n}\n","/**\n * Reevit State Machine\n * Shared state management logic for all SDKs\n */\n\nimport type { CheckoutState, PaymentIntent, PaymentMethod, PaymentResult, PaymentError } from './types';\n\n// State shape\nexport interface ReevitState {\n  status: CheckoutState;\n  paymentIntent: PaymentIntent | null;\n  selectedMethod: PaymentMethod | null;\n  error: PaymentError | null;\n  result: PaymentResult | null;\n}\n\n// Actions\nexport type ReevitAction =\n  | { type: 'INIT_START' }\n  | { type: 'INIT_SUCCESS'; payload: PaymentIntent }\n  | { type: 'INIT_ERROR'; payload: PaymentError }\n  | { type: 'SELECT_METHOD'; payload: PaymentMethod }\n  | { type: 'PROCESS_START' }\n  | { type: 'PROCESS_SUCCESS'; payload: PaymentResult }\n  | { type: 'PROCESS_ERROR'; payload: PaymentError }\n  | { type: 'RESET' }\n  | { type: 'CLOSE' };\n\n/**\n * Creates the initial state for the checkout\n */\nexport function createInitialState(): ReevitState {\n  return {\n    status: 'idle',\n    paymentIntent: null,\n    selectedMethod: null,\n    error: null,\n    result: null,\n  };\n}\n\n/**\n * State reducer for checkout flow\n */\nexport function reevitReducer(state: ReevitState, action: ReevitAction): ReevitState {\n  switch (action.type) {\n    case 'INIT_START':\n      return { ...state, status: 'loading', error: null };\n    case 'INIT_SUCCESS':\n      return {\n        ...state,\n        status: 'ready',\n        paymentIntent: action.payload,\n        selectedMethod:\n          action.payload.availableMethods?.length === 1 ? action.payload.availableMethods[0] : null,\n      };\n    case 'INIT_ERROR':\n      return { ...state, status: 'failed', error: action.payload };\n    case 'SELECT_METHOD':\n      return { ...state, status: 'method_selected', selectedMethod: action.payload };\n    case 'PROCESS_START':\n      return { ...state, status: 'processing', error: null };\n    case 'PROCESS_SUCCESS':\n      return { ...state, status: 'success', result: action.payload };\n    case 'PROCESS_ERROR':\n      return { ...state, status: 'failed', error: action.payload };\n    case 'RESET':\n      return { ...createInitialState(), status: 'ready', paymentIntent: state.paymentIntent };\n    case 'CLOSE':\n      return { ...state, status: 'closed' };\n    default:\n      return state;\n  }\n}\n"],"mappings":"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","names":[]}